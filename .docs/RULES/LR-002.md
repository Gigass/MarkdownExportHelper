# LR-002: 代码质量规则

## 规则信息

**规则ID**: LR-002  
**规则名称**: 代码质量规则  
**状态**: 活跃  
**优先级**: 高  
**创建日期**: 2024-12-19  
**维护者**: AI 开发伙伴  

## 规则定义

### 触发情景
- 编写新的 JavaScript 代码
- 修改现有代码逻辑
- 重构代码结构
- 添加新功能模块

### 核心指令
1. **代码风格**: 遵循一致的代码风格和命名规范
2. **错误处理**: 所有异步操作和用户输入必须包含适当的错误处理
3. **性能优化**: 避免性能瓶颈，特别是内存泄漏和重复计算
4. **安全性**: 所有用户输入必须经过安全处理
5. **可维护性**: 代码必须清晰、模块化，便于维护和扩展

## 代码标准

### JavaScript 编码规范
- **ES6+ 语法**: 优先使用现代 JavaScript 特性
- **const/let**: 优先使用 const，需要重新赋值时使用 let
- **箭头函数**: 优先使用箭头函数，保持 this 上下文一致
- **模板字符串**: 使用模板字符串替代字符串拼接
- **解构赋值**: 合理使用解构赋值简化代码

### 命名规范
- **变量/函数**: 使用 camelCase
- **常量**: 使用 UPPER_SNAKE_CASE
- **类名**: 使用 PascalCase
- **文件名**: 使用 kebab-case
- **描述性命名**: 避免缩写，使用有意义的名称

### 代码结构
- **模块化**: 按功能组织代码，避免单一文件过长
- **函数职责**: 每个函数只负责一个明确的功能
- **注释**: 复杂逻辑必须添加注释说明
- **导入顺序**: 第三方库 → 本地模块 → 相对路径

## 安全要求

### 输入验证
- **用户输入**: 所有用户输入必须验证和清理
- **XSS 防护**: 使用 DOMPurify 处理 HTML 内容
- **数据验证**: 验证数据类型和格式
- **边界检查**: 检查数组索引和对象属性访问

### 错误处理
- **try-catch**: 异步操作必须包含错误处理
- **用户反馈**: 向用户提供清晰的错误信息
- **优雅降级**: 功能失败时提供替代方案
- **日志记录**: 记录关键错误信息便于调试

## 性能要求

### 内存管理
- **事件监听器**: 及时移除不需要的事件监听器
- **定时器**: 清理不需要的定时器
- **大对象**: 及时释放大型对象引用
- **DOM 操作**: 批量处理 DOM 操作，减少重排重绘

### 优化策略
- **防抖节流**: 对频繁触发的事件使用防抖或节流
- **懒加载**: 按需加载非关键资源
- **缓存**: 合理使用缓存减少重复计算
- **异步处理**: 避免阻塞主线程的长时间操作

## 测试要求

### 测试覆盖
- **核心功能**: 所有核心功能必须有测试用例
- **边界条件**: 测试边界条件和异常情况
- **用户交互**: 测试用户交互流程
- **兼容性**: 测试不同浏览器版本的兼容性

### 测试类型
- **单元测试**: 测试独立函数和模块
- **集成测试**: 测试模块间的交互
- **端到端测试**: 测试完整的用户流程
- **性能测试**: 测试关键功能的性能表现

## 文档要求

### 代码文档
- **函数注释**: 复杂函数必须包含 JSDoc 注释
- **参数说明**: 说明参数类型和用途
- **返回值**: 说明返回值类型和含义
- **示例代码**: 提供使用示例

### 架构文档
- **模块说明**: 说明每个模块的职责
- **数据流**: 描述数据在模块间的流动
- **依赖关系**: 说明模块间的依赖关系
- **扩展点**: 说明如何扩展和维护

## 审查流程

### 代码审查
- **功能正确性**: 验证功能实现是否正确
- **代码质量**: 检查代码风格和结构
- **安全性**: 验证安全措施是否到位
- **性能**: 检查是否存在性能问题

### 自动化检查
- **ESLint**: 使用 ESLint 检查代码风格
- **Prettier**: 使用 Prettier 格式化代码
- **TypeScript**: 考虑使用 TypeScript 提高代码质量
- **CI/CD**: 集成自动化测试和部署

## 违规处理

### 轻微违规
- 代码风格不一致
- 缺少注释
- 命名不规范

**处理方式**: 立即修正，更新相关文档

### 严重违规
- 安全漏洞
- 性能问题
- 功能错误

**处理方式**: 立即修复，进行回归测试

## 维护责任

- **开发者**: 负责编写高质量的代码
- **审查者**: 负责代码审查和质量把关
- **AI 助手**: 负责主动发现和提醒质量问题

## 相关文档

- `.docs/STATE/TECH-STACK.md` - 技术栈说明
- `.docs/PROCESS/CODE-REVIEW.md` - 代码审查流程
- `.docs/TEMPLATES/` - 代码模板

---

*规则状态: 活跃*  
*最后更新: 2024-12-19*  
*下次审查: 2025-01-19* 